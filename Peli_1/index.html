<!DOCTYPE html>
<html>
<head>
    <title>Paratrooper peli</title>
    <meta charset="UTF-8">
    <style>
        /* Perus tyylitys pelille */
        canvas {
            border: 2px solid #333;
            background: linear-gradient(to bottom, #1a1a3a, #0f0f2f);
        }
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            background: #000000;
        }
       
        #canvasContainer {
            position: relative;
            display: flex;
            justify-content: center;
        }
       
        #gameCanvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="canvasContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>
    <script>
        // Canvas ja kontekstin alustus
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ===== PELI KOKOONPANO =====
        // Alex - Pelimekaniikka asetukset
        const GAME_CONFIG = {
            // Miro - Aloitusarvot ja vaikeustasot
            initialLives: 5,
            initialDifficultyLevel: 1,
            scoreDifficultyIncrease: 2500, // Pisteet vaikeustason nousuun
            
            // Alex - Aseistus ja tulinopeus
            fireRate: {
                normal: 167,    // Normaali tulinopeus (ms)
                burst: 16.7     // Burst-tilan tulinopeus (ms)
            },
            burstMode: {
                duration: 3000,   // Burst-tilan kesto (ms)
                cooldown: 8000    // Burst-tilan cooldown (ms)
            },
            
            // Alex - Vihollisten spawni ajastukset
            spawn: {
                plane: 2000,        // Lentokoneiden spawni intervalli (ms)
                crate: 4000,        // Laatikoiden spawni intervalli (ms)
                airship: 10000,     // Ilmalaivan spawni intervalli (ms)
                crateChance: 0.05   // Laatikon spawni todennäköisyys
            },
            
            // Alex - Nopeudet eri olioille
            speed: {
                bullet: 0.7,         // Luodin nopeus
                plane: 0.24,         // Lentokoneen nopeus
                paratrooper: 0.06,   // Laskuvarjosoturin nopeus
                airship: 0.12,       // Ilmalaivan nopeus
                crate: 0.25          // Laatikon putoamisnopeus
            },
            
            // Miro - Vihollisten terveys ja ominaisuudet
            entity: {
                bulletRadius: 3,
                toughParatrooperHealth: 3,      // Kova laskuvarjosoturi
                normalParatrooperHealth: 1,     // Normaali laskuvarjosoturi
                eliteParatrooperHealth: 6,      // Elite laskuvarjosoturi
                paraDropChance: 0.01,           // Laskuvarjosoturin pudotus todennäköisyys
                eliteMinDifficulty: 4           // Minimi vaikeustaso elite-sotureille
            },
            
            // Alex - Pisteet eri vihollisista
            score: {
                normalParatrooper: 100,
                toughParatrooper: 300,
                eliteParatrooper: 600
            },
            
            // Alex - Bonusten kestot ja arvot
            bonus: {
                slowMo: 10000,                  // Hidastuksen kesto (ms)
                scoreMultiplier: 15000,         // Pistekerroin kesto (ms)
                scoreMultiplierValue: 2,        // Pistekerroin arvo
                spreadFire: 10000,              // Hajatuli kesto (ms)
                spreadCount: 3,                 // Hajatuli ammusten määrä
                bigBullets: 10000               // Isot ammukset kesto (ms)
            }
        };

        // ===== PELI LUOKKA =====
        // Alex - Pääpelin hallinta ja pelimekaniikka
        class Game {
            constructor() {
                // Peliobjektien alustus
                this.cannon = new Cannon();
                this.bullets = [];
                this.planes = [];
                this.paratroopers = [];
                this.crates = [];
                
                // Alex - Pelitilanne muuttujat
                this.score = 0;
                this.lives = GAME_CONFIG.initialLives;
                this.gameOver = false;
                this.gameStarted = false;
                
                // Alex - Spawni ajastimet
                this.planeSpawnTimer = 0;
                this.airshipSpawnTimer = 0;
                this.crateSpawnTimer = 0;
                
                // Alex - Hiiren ja ampumisen hallinta
                this.mouseAngle = 0;
                this.isMouseDown = false;
                this.normalFireRate = GAME_CONFIG.fireRate.normal;
                this.burstFireRate = GAME_CONFIG.fireRate.burst;
                this.fireRate = this.normalFireRate;
                this.fireTimer = 0;
                
                // Alex - Burst-tilan hallinta
                this.burstModeActive = false;
                this.burstModeTimer = 0;
                this.burstModeCooldown = 0;
                this.burstFromCrate = false;
                
                // Samu - Äänimanageri
                this.audio = new AudioManager();
                
                // Miro - Vaikeustaso hallinta
                this.difficultyLevel = GAME_CONFIG.initialDifficultyLevel;
                this.lastDifficultyScore = 0;
                
                // Alex - Aika ja delta-aika
                this.lastUpdateTime = 0;
                this.deltaTime = 0;
                
                // Alex - Aktiiviset tehosteet
                this.activeEffects = {
                    slowMo: { active: false, timer: 0, duration: GAME_CONFIG.bonus.slowMo },
                    scoreMultiplier: { active: false, timer: 0, duration: GAME_CONFIG.bonus.scoreMultiplier, value: GAME_CONFIG.bonus.scoreMultiplierValue },
                    spreadFire: { active: false, timer: 0, duration: GAME_CONFIG.bonus.spreadFire, count: GAME_CONFIG.bonus.spreadCount },
                    bigBullets: { active: false, timer: 0, duration: GAME_CONFIG.bonus.bigBullets }
                };

                // Hiiren liike tapahtumankäsittelijä
                canvas.addEventListener('mousemove', (e) => {
                    this.handlePointerMove(e.clientX, e.clientY);
                });
                
                // Hiiren painallus tapahtumankäsittelijät
                canvas.addEventListener('mousedown', () => {
                    this.isMouseDown = true;
                });
                canvas.addEventListener('mouseup', () => {
                    this.isMouseDown = false;
                });
                
                // Klikkaus käynnistää pelin tai resetoi sen
                canvas.addEventListener('click', () => {
                    if (!this.gameStarted) {
                        this.gameStarted = true;
                        this.audio.context.resume();
                    } else if (this.gameOver) {
                        this.reset();
                    }
                });

                // Näppäimistö tapahtumankäsittelijä (SPACE burst-tilaan)
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !this.burstModeActive && this.burstModeCooldown <= 0) {
                        this.activateBurstMode();
                    }
                });
            }

            // Alex - Hiiren liikkeen käsittely ja tykin ohjaus
            handlePointerMove(clientX, clientY) {
                const rect = canvas.getBoundingClientRect();
                const canvasX = clientX - rect.left;
                const canvasY = clientY - rect.top;
                const x = canvasX - this.cannon.x;
                const y = canvasY - this.cannon.y;
                this.mouseAngle = Math.atan2(y, x);
                // Rajoita kulma -180° ja 0° välillä (vain ylöspäin)
                this.cannon.angle = Math.max(-Math.PI, Math.min(0, this.mouseAngle));
            }

            // Alex - Pelin nollaus
            reset() {
                this.cannon = new Cannon();
                this.bullets = [];
                this.planes = [];
                this.paratroopers = [];
                this.crates = [];
                this.score = 0;
                this.lives = GAME_CONFIG.initialLives;
                this.gameOver = false;
                this.planeSpawnTimer = 0;
                this.fireTimer = 0;
                this.crateSpawnTimer = 0;
                this.burstModeActive = false;
                this.burstModeTimer = 0;
                this.burstModeCooldown = 0;
                this.difficultyLevel = GAME_CONFIG.initialDifficultyLevel;
                this.lastDifficultyScore = 0;
                this.airshipSpawnTimer = 0;
               
                // Nollaa kaikki aktiiviset tehosteet
                Object.keys(this.activeEffects).forEach(key => {
                    this.activeEffects[key].active = false;
                    this.activeEffects[key].timer = 0;
                });
            }

            // Alex - Burst-tilan aktivointi
            activateBurstMode() {
                this.burstModeActive = true;
                this.burstModeTimer = GAME_CONFIG.burstMode.duration;
                this.fireRate = this.burstFireRate;
                this.burstFromCrate = false;
            }

            // Alex - Pelin päivityssilmukka (pelimekaniikka)
            update(timestamp) {
                // Laske delta-aika sujuvaan liikkeeseen
                if (this.lastUpdateTime === 0) {
                    this.lastUpdateTime = timestamp;
                }
                this.deltaTime = timestamp - this.lastUpdateTime;
                this.lastUpdateTime = timestamp;
               
                // Älä päivitä jos peli ei ole käynnissä
                if (!this.gameStarted) return;
                if (this.gameOver) return;

                // Päivitä aktiiviset tehosteet
                this.updateEffects();

                // Alex - Burst-tilan hallinta
                if (this.burstModeActive) {
                    this.burstModeTimer -= this.deltaTime;
                    if (this.burstModeTimer <= 0) {
                        this.burstModeActive = false;
                        this.fireRate = this.normalFireRate;
                        if (!this.burstFromCrate) {
                            this.burstModeCooldown = GAME_CONFIG.burstMode.cooldown;
                        }
                        this.burstFromCrate = false;
                    }
                }
                if (this.burstModeCooldown > 0) {
                    this.burstModeCooldown -= this.deltaTime;
                }

                // Alex - Automaattinen ampuminen hiiren ollessa pohjassa
                if (this.isMouseDown) {
                    this.fireTimer += this.deltaTime;
                    if (this.fireTimer >= this.fireRate) {
                        this.fireBullets();
                        this.audio.playSound('fire'); // Samu - Ampumisääni
                        this.fireTimer = 0;
                    }
                }

                // Alex - Lentokoneiden spawni
                this.planeSpawnTimer += this.deltaTime;
                if (this.planeSpawnTimer > GAME_CONFIG.spawn.plane) {
                    this.planes.push(new Plane());
                    this.planeSpawnTimer = 0;
                }

                // Alex - Laatikoiden spawni
                this.crateSpawnTimer += this.deltaTime;
                if (this.crateSpawnTimer > GAME_CONFIG.spawn.crate) {
                    if (Math.random() < GAME_CONFIG.spawn.crateChance) {
                        const x = Math.random() * (canvas.width - 100) + 50;
                        this.crates.push(new Crate(x));
                        this.crateSpawnTimer = 0;
                    } else {
                        this.crateSpawnTimer = 7000;
                    }
                }

                // Miro - Vaikeustason nosto pisteiden perusteella
                if (this.score >= this.lastDifficultyScore + GAME_CONFIG.scoreDifficultyIncrease) {
                    this.difficultyLevel++;
                    this.lastDifficultyScore = this.score;
                }

                // Alex - Ilmalaivojen spawni
                this.airshipSpawnTimer += this.deltaTime;
                if (this.airshipSpawnTimer > GAME_CONFIG.spawn.airship && Math.random() < 0.01) {
                    this.planes.push(new Airship());
                    this.airshipSpawnTimer = 0;
                }
               
                // Alex - Luotien päivitys ja poisto
                this.bullets = this.bullets.filter(bullet => bullet.isActive());
                this.bullets.forEach(bullet => bullet.update(this.deltaTime));

                // Alex - Lentokoneiden päivitys ja laskuvarjosoturien pudotus
                this.planes.forEach(plane => {
                    const speedMultiplier = this.activeEffects.slowMo.active ? 0.5 : 1;
                    plane.update(this.deltaTime * speedMultiplier);
                    if (plane.shouldDropParatrooper()) {
                        // Miro - Määritä laskuvarjosoturin tyyppi vaikeustason mukaan
                        let isElite = false;
                        let isTough = false;
                        if (this.difficultyLevel >= GAME_CONFIG.entity.eliteMinDifficulty) {
                            isElite = Math.random() < (this.difficultyLevel - GAME_CONFIG.entity.eliteMinDifficulty + 1) * 0.05;
                        }
                        if (!isElite) {
                            isTough = Math.random() < (this.difficultyLevel - 1) * 0.1;
                        }
                        this.paratroopers.push(new Paratrooper(plane.x, plane.y, isTough, isElite));
                        this.audio.playSound('parachute'); // Samu - Laskuvarjoääni
                    }
                });
                this.planes = this.planes.filter(plane => plane.isActive());

                // Alex - Laskuvarjosoturien päivitys
                this.paratroopers.forEach(para => {
                    const speedMultiplier = this.activeEffects.slowMo.active ? 0.5 : 1;
                    para.update(this.deltaTime * speedMultiplier);
                });
                this.paratroopers = this.paratroopers.filter(para => para.isActive());

                // Alex - Laatikoiden päivitys
                this.crates.forEach(crate => crate.update(this.deltaTime));
                this.crates = this.crates.filter(crate => crate.active);

                // Alex - Törmäysten tarkistus luodit vs laskuvarjosoturit ja laatikot
                this.bullets.forEach(bullet => {
                    this.paratroopers.forEach(para => {
                        if (bullet.checkCollision(para)) {
                            bullet.active = false;
                            const damageAmount = bullet.radius > GAME_CONFIG.entity.bulletRadius ? 3 : 1;
                            para.health -= damageAmount;
                            if (para.health <= 0) {
                                para.active = false;
                                // Alex - Pisteiden laskenta vihollistyypistä
                                let points;
                                if (para.isElite) {
                                    points = GAME_CONFIG.score.eliteParatrooper;
                                } else if (para.isTough) {
                                    points = GAME_CONFIG.score.toughParatrooper;
                                } else {
                                    points = GAME_CONFIG.score.normalParatrooper;
                                }
                                this.score += this.activeEffects.scoreMultiplier.active ?
                                    points * this.activeEffects.scoreMultiplier.value : points;
                                this.audio.playSound('hit'); // Samu - Osuma ääni
                            } else {
                                this.audio.playSound('toughHit'); // Samu - Kova osuma ääni
                            }
                        }
                    });
                   
                    // Alex - Törmäys luodit vs laatikot
                    this.crates.forEach(crate => {
                        if (bullet.checkCollisionWithCrate(crate)) {
                            bullet.active = false;
                            crate.active = false;
                            this.applyBonus(crate.bonus);
                            this.audio.playSound('powerup'); // Samu - Power-up ääni
                        }
                    });
                });

                // Alex - Tarkista osuiko laskuvarjosoturi maahan
                this.paratroopers.forEach(para => {
                    if (para.hasLanded()) {
                        this.lives--;
                        para.active = false;
                        this.audio.playSound('ground'); // Samu - Maahan osumisen ääni
                        if (this.lives <= 0) {
                            this.gameOver = true;
                        }
                    }
                });
            }

            // Alex - Aktiivisten tehosteiden päivitys
            updateEffects() {
                Object.keys(this.activeEffects).forEach(effectName => {
                    const effect = this.activeEffects[effectName];
                    if (effect.active) {
                        effect.timer -= this.deltaTime;
                        if (effect.timer <= 0) {
                            effect.active = false;
                        }
                    }
                });
            }
           
            // Alex - Luotien ampuminen (hajatuli tai normaali)
            fireBullets() {
                if (this.activeEffects.spreadFire.active) {
                    const spreadCount = this.activeEffects.spreadFire.count;
                    const spreadAngle = Math.PI / 12;
                    for (let i = 0; i < spreadCount; i++) {
                        const angle = this.cannon.angle - (spreadAngle * (spreadCount-1) / 2) + (spreadAngle * i);
                        const bullet = new Bullet(this.cannon.x, this.cannon.y, angle);
                        if (this.activeEffects.bigBullets.active) {
                            bullet.radius = 6;
                        }
                        this.bullets.push(bullet);
                    }
                } else {
                    const bullet = new Bullet(this.cannon.x, this.cannon.y, this.cannon.angle);
                    if (this.activeEffects.bigBullets.active) {
                        bullet.radius = 6;
                    }
                    this.bullets.push(bullet);
                }
            }
           
            // Alex - Bonusten aktivointi
            applyBonus(bonus) {
                switch(bonus.type) {
                    case 'points':
                        this.score += bonus.value;
                        this.showFloatingText('+' + bonus.value, bonus.color);
                        break;
                    case 'life':
                        this.lives += bonus.value;
                        this.showFloatingText('+1 LIFE', bonus.color);
                        break;
                    case 'burst':
                        this.burstModeActive = true;
                        this.burstModeTimer = 3000;
                        this.fireRate = this.burstFireRate;
                        this.burstFromCrate = true;
                        this.showFloatingText('BURST MODE', bonus.color);
                        break;
                    case 'multishot':
                        this.activeEffects.spreadFire.active = true;
                        this.activeEffects.spreadFire.timer = GAME_CONFIG.bonus.spreadFire;
                        this.showFloatingText('SPREAD FIRE', bonus.color);
                        break;
                    case 'slowmo':
                        this.activeEffects.slowMo.active = true;
                        this.activeEffects.slowMo.timer = GAME_CONFIG.bonus.slowMo;
                        this.showFloatingText('SLOW MOTION', bonus.color);
                        break;
                    case 'nuke':
                        this.paratroopers.forEach(para => {
                            para.active = false;
                            this.score += para.isTough ? 300 : 100;
                        });
                        this.showFloatingText('NUKE', bonus.color);
                        break;
                    case 'bigbullet':
                        this.activeEffects.bigBullets.active = true;
                        this.activeEffects.bigBullets.timer = GAME_CONFIG.bonus.bigBullets;
                        this.showFloatingText('BIG BULLETS', bonus.color);
                        break;
                    case 'scorex2':
                        this.activeEffects.scoreMultiplier.active = true;
                        this.activeEffects.scoreMultiplier.timer = GAME_CONFIG.bonus.scoreMultiplier;
                        this.showFloatingText('SCORE x2', bonus.color);
                        break;
                }
            }
           
            // Placeholder kelluvalle tekstille
            showFloatingText(text, color) {
                console.log("Bonus aktivoitu:", text);
            }

            // Samu & Miro - Piirtofunktio (kaikki grafiikka)
            draw() {
                // Miro - Aloitusnäyttö
                if (!this.gameStarted) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 40px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Paratrooper Peli', canvas.width/2, 60);
                    
                    // Miro - Ohjeet
                    ctx.font = '16px Arial';
                    ctx.fillText('Ammu vihollisia alas ennenkuin laskeutuvat!', canvas.width/2, 100);
                    ctx.fillText('Käytä hiirtä tähtääkseen ja clickaa Paina SPACE saat burst tilan.', canvas.width/2, 130);
                    
                    // Miro - Vihollistyyppien esittely
                    ctx.font = 'bold 20px Arial';
                    ctx.fillText('Viholliset', canvas.width/2, 195);
                    this.drawSampleTrooper(canvas.width/2 - 150, 245, false, false, 'Normaali - 1 HP', '#f44');
                    this.drawSampleTrooper(canvas.width/2, 245, true, false, 'Vaikea - 3 HP', '#44f');
                    this.drawSampleTrooper(canvas.width/2 + 150, 245, false, true, 'Vaikein - 6 HP', '#ffcc00');
                    
                    // Miro - Power-upien esittely
                    ctx.font = 'bold 20px Arial';
                    ctx.fillText('Voima Laatikoita', canvas.width/2, 315);
                    const crateTypes = [
                        { type: 'points', color: '#ffd700', symbol: '', desc: 'Points +1000' },
                        { type: 'life', color: '#ff4444', symbol: '', desc: '+1 Life' },
                        { type: 'burst', color: '#ff8800', symbol: '', desc: 'Burst Modi' },
                        { type: 'multishot', color: '#44ff44', symbol: '', desc: 'Jakautuvat ammukset' }
                    ];
                    const crateTypes2 = [
                        { type: 'slowmo', color: '#aa44ff', symbol: '', desc: 'Hidastus' },
                        { type: 'nuke', color: '#ff0000', symbol: '', desc: 'Tyhjä ruutu' },
                        { type: 'bigbullet', color: '#4444ff', symbol: '', desc: 'Isot panokset' },
                        { type: 'scorex2', color: '#ffd700', symbol: '', desc: 'Pisteet x2' }
                    ];
                    for (let i = 0; i < crateTypes.length; i++) {
                        this.drawSampleCrate(canvas.width/4 + (i * 150), 350, crateTypes[i].color, crateTypes[i].symbol, crateTypes[i].desc);
                    }
                    for (let i = 0; i < crateTypes2.length; i++) {
                        this.drawSampleCrate(canvas.width/4 + (i * 150), 420, crateTypes2[i].color, crateTypes2[i].symbol, crateTypes2[i].desc);
                    }
                    
                    // Miro - Aloitusohje
                    ctx.font = 'bold 22px Arial';
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText('Paina Aloittaaksesi', canvas.width/2, 520);
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#aaaaaa';
                    
                    return;
                }

                // Samu - Pelin piirto alkaa
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Samu - Tähtitaivas
                for (let i = 0; i < 100; i++) {
                    ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.5})`;
                    ctx.fillRect(Math.random() * canvas.width, Math.random() * (canvas.height - 100), 1, 1);
                }

                // Samu - Maa
                const groundGradient = ctx.createLinearGradient(0, canvas.height - 40, 0, canvas.height);
                groundGradient.addColorStop(0, '#3a5');
                groundGradient.addColorStop(1, '#263');
                ctx.fillStyle = groundGradient;
                ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

                // Samu - Piirretään kaikki peliobjektit
                this.cannon.draw();
                this.bullets.forEach(bullet => bullet.draw());
                this.planes.forEach(plane => plane.draw());
                this.paratroopers.forEach(para => para.draw());
                this.crates.forEach(crate => crate.draw());

                // Alex & Samu - Burst-tilan näyttö
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'left';
                if (this.burstModeActive) {
                    ctx.fillStyle = '#ff0';
                    ctx.fillText(`BURST MODE: ${Math.ceil(this.burstModeTimer / 1000)}s`, 10, 90);
                } else if (this.burstModeCooldown > 0) {
                    ctx.fillStyle = '#999';
                    ctx.fillText(`BURST READY IN: ${Math.ceil(this.burstModeCooldown / 1000)}s`, 10, 90);
                } else {
                    ctx.fillStyle = '#0f0';
                    ctx.fillText('BURST READY [SPACE]', 10, 90);
                }

                // Samu - Aktiiviset tehosteet näyttö
                this.drawActiveEffects();

                // Samu - Pisteet ja elämät
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 20px Arial';
                ctx.fillText(`Score: ${this.score}`, 10, 30);
                ctx.fillText(`Lives: ${this.lives}`, 10, 60);
               
                ctx.font = '14px Arial';
                ctx.textAlign = 'right';
                ctx.fillStyle = '#aaaaaa';
                ctx.fillText('', canvas.width - 10, canvas.height - 10);
                ctx.textAlign = 'left';

                // Samu & Miro - Game over näyttö
                if (this.gameOver) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 40px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2);
                    ctx.font = '20px Arial';
                    ctx.fillText(`Final Score: ${this.score}`, canvas.width/2, canvas.height/2 + 40);
                    ctx.fillText('Click to restart', canvas.width/2, canvas.height/2 + 80);
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillStyle = '#aaaaaa';
                    ctx.fillText('', canvas.width - 10, canvas.height - 10);
                    ctx.textAlign = 'left';
                }
            }
           
            // Samu - Aktiivisten tehosteiden piirto
            drawActiveEffects() {
                let y = 120;
                const x = 10;
                ctx.textAlign = 'left';
                ctx.font = 'bold 14px Arial';
                if (this.activeEffects.slowMo.active) {
                    ctx.fillStyle = '#aa44ff';
                    ctx.fillText(`SLOW MO: ${Math.ceil(this.activeEffects.slowMo.timer/1000)}s`, x, y);
                    y += 20;
                }
                if (this.activeEffects.scoreMultiplier.active) {
                    ctx.fillStyle = '#ffd700';
                    ctx.fillText(`SCORE x${this.activeEffects.scoreMultiplier.value}: ${Math.ceil(this.activeEffects.scoreMultiplier.timer/1000)}s`, x, y);
                    y += 20;
                }
                if (this.activeEffects.spreadFire.active) {
                    ctx.fillStyle = '#44ff44';
                    ctx.fillText(`SPREAD FIRE: ${Math.ceil(this.activeEffects.spreadFire.timer/1000)}s`, x, y);
                    y += 20;
                }
                if (this.activeEffects.bigBullets.active) {
                    ctx.fillStyle = '#ff8800';
                    ctx.fillText(`BIG BULLETS: ${Math.ceil(this.activeEffects.bigBullets.timer/1000)}s`, x, y);
                    y += 20;
                }
            }

            // Miro & Samu - Esimerkki laskuvarjosoturi aloitusnäyttöön
            drawSampleTrooper(x, y, isTough, isElite, label, color) {
                // Laskuvarjo
                ctx.beginPath();
                ctx.moveTo(x - 20, y - 20);
                ctx.quadraticCurveTo(x, y - 45, x + 20, y - 20);
                const paraGradient = ctx.createLinearGradient(x, y - 45, x, y - 20);
                paraGradient.addColorStop(0, color);
                paraGradient.addColorStop(1, isElite ? '#cc7700' : (isTough ? '#229' : '#922'));
                ctx.fillStyle = paraGradient;
                ctx.fill();
                ctx.strokeStyle = '#600';
                ctx.stroke();
                
                // Köydet
                ctx.beginPath();
                ctx.moveTo(x - 20, y - 20);
                ctx.lineTo(x, y);
                ctx.moveTo(x + 20, y - 20);
                ctx.lineTo(x, y);
                ctx.strokeStyle = '#fff';
                ctx.stroke();
                
                // Pää
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                if (isElite) {
                    ctx.fillStyle = '#cc7700';
                } else if (isTough) {
                    ctx.fillStyle = '#229';
                } else {
                    ctx.fillStyle = '#922';
                }
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.stroke();
                
                // Jalat
                ctx.beginPath();
                ctx.moveTo(x, y + 5);
                ctx.lineTo(x - 5, y + 12);
                ctx.moveTo(x, y + 5);
                ctx.lineTo(x + 5, y + 12);
                if (isElite) {
                    ctx.strokeStyle = '#cc7700';
                } else if (isTough) {
                    ctx.strokeStyle = '#229';
                } else {
                    ctx.strokeStyle = '#922';
                }
                ctx.stroke();
                
                // Terveyspisteet
                if (isTough || isElite) {
                    ctx.fillStyle = isElite ? '#ffcc00' : '#44f';
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(isElite ? "6" : "3", x, y - 25);
                }
                
                // Nimi
                ctx.font = '14px Arial';
                ctx.fillStyle = '#fff';
                ctx.fillText(label, x, y + 30);
            }

            // Miro & Samu - Esimerkki laatikko aloitusnäyttöön
            drawSampleCrate(x, y, color, symbol, description) {
                const width = 30;
                const height = 30;
                ctx.save();
                ctx.translate(x, y);
                
                // Laatikko
                ctx.fillStyle = color;
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.fillRect(-width/2, -height/2, width, height);
                ctx.strokeRect(-width/2, -height/2, width, height);
                
                // Risti kuvio
                ctx.beginPath();
                ctx.moveTo(-width/2, 0);
                ctx.lineTo(width/2, 0);
                ctx.moveTo(0, -height/2);
                ctx.lineTo(0, height/2);
                ctx.strokeStyle = '#ffffff80';
                ctx.stroke();
                
                // Symboli
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(symbol, 0, 0);
                ctx.restore();
                
                // Kuvaus
                ctx.font = '14px Arial';
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.fillText(description, x, y + 35);
            }
        }

        // ===== TYKKI LUOKKA =====
        // Samu - Tykin piirto ja sijainti
        class Cannon {
            constructor() {
                this.x = canvas.width / 2;      // Keskellä ruutua
                this.y = canvas.height - 40;    // Maan tasolla
                this.angle = -Math.PI / 4;      // Oletuskulma 45° ylös
            }
            
            // Samu - Tykin piirto (pallo ja piippu)
            draw() {
                // Tykin pallo
                ctx.beginPath();
                ctx.arc(this.x, this.y, 20, 0, Math.PI * 2);
                const baseGradient = ctx.createRadialGradient(this.x + 5, this.y - 5, 0, this.x, this.y, 20);
                baseGradient.addColorStop(0, '#999');
                baseGradient.addColorStop(1, '#555');
                ctx.fillStyle = baseGradient;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.stroke();
                
                // Tykin piippu (pyörii kulman mukaan)
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                const barrelGradient = ctx.createLinearGradient(0, -8, 0, 8);
                barrelGradient.addColorStop(0, '#777');
                barrelGradient.addColorStop(0.5, '#999');
                barrelGradient.addColorStop(1, '#666');
                ctx.fillStyle = barrelGradient;
                ctx.fillRect(0, -8, 45, 16);
                ctx.strokeStyle = '#444';
                ctx.strokeRect(0, -8, 45, 16);
                ctx.restore();
            }
        }

        // ===== LUOTI LUOKKA =====
        // Alex - Luodin liike ja törmäykset
        class Bullet {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.speed = GAME_CONFIG.speed.bullet;
                this.angle = angle;
                this.active = true;
                this.radius = GAME_CONFIG.entity.bulletRadius;
            }
            
            // Alex - Luodin liike
            update(deltaTime) {
                this.x += Math.cos(this.angle) * this.speed * deltaTime;
                this.y += Math.sin(this.angle) * this.speed * deltaTime;
                // Poista luoti jos menee ruudun ulkopuolelle
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.active = false;
                }
            }
            
            // Samu - Luodin piirto
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                const bulletGradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius);
                bulletGradient.addColorStop(0, '#ff0');
                bulletGradient.addColorStop(1, '#f00');
                ctx.fillStyle = bulletGradient;
                ctx.fill();
            }
            
            // Alex - Törmäyksen tarkistus laskuvarjosoturin kanssa
            checkCollision(para) {
                const dx = this.x - para.x;
                const dy = this.y - para.y;
                return Math.sqrt(dx * dx + dy * dy) < 25;
            }
            
            // Alex - Aktiivisuuden tarkistus
            isActive() {
                return this.active;
            }
            
            // Alex - Törmäyksen tarkistus laatikon kanssa
            checkCollisionWithCrate(crate) {
                const dx = this.x - crate.x;
                const dy = this.y - crate.y;
                return Math.sqrt(dx * dx + dy * dy) < (this.radius + crate.width/2);
            }
        }

        // ===== LENTOKONE LUOKKA =====
        // Samu - Lentokoneen piirto ja animaatio
        // Alex - Lentokoneen liike ja laskuvarjosoturien pudotus
        class Plane {
            constructor() {
                this.direction = Math.random() < 0.5 ? 1 : -1;  // Satunnainen suunta
                this.x = this.direction === 1 ? -50 : canvas.width + 50;
                this.y = 50 + Math.random() * 100;
                this.speed = GAME_CONFIG.speed.plane;
                this.dropTimer = 0;
                this.active = true;
                this.propellerAngle = 0;  // Samu - Potkurin animaatio
            }
            
            // Alex - Lentokoneen liike
            update(deltaTime) {
                this.x += this.direction * this.speed * deltaTime;
                this.dropTimer += deltaTime;
                // Poista lentokone jos menee ruudun ulkopuolelle
                if (this.x < -100 || this.x > canvas.width + 100) {
                    this.active = false;
                }
                // Samu - Potkurin pyöritys
                this.propellerAngle += 0.05 * deltaTime;
                if (this.propellerAngle > Math.PI * 2) {
                    this.propellerAngle = 0;
                }
            }
            
            // Samu - Lentokoneen piirto (runko, ohjaamo, potkuri)
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                if (this.direction < 0) {
                    ctx.scale(-1, 1);  // Käännä lentokone vasemmalle
                }
                
                // Lentokoneen runko
                ctx.beginPath();
                ctx.moveTo(-30, 0);
                ctx.lineTo(30, 0);
                ctx.lineTo(25, 10);
                ctx.lineTo(-25, 10);
                ctx.closePath();
                const bodyGradient = ctx.createLinearGradient(0, -5, 0, 15);
                bodyGradient.addColorStop(0, '#a8a8a8');
                bodyGradient.addColorStop(0.4, '#d8d8d8');
                bodyGradient.addColorStop(1, '#707070');
                ctx.fillStyle = bodyGradient;
                ctx.fill();
                ctx.strokeStyle = '#444';
                ctx.lineWidth = 1.5;
                ctx.stroke();
                
                // Ohjaamo
                ctx.beginPath();
                ctx.ellipse(10, 0, 12, 7, 0, 0, Math.PI * 2);
                const cockpitGradient = ctx.createLinearGradient(10, -7, 10, 7);
                cockpitGradient.addColorStop(0, '#6aafff');
                cockpitGradient.addColorStop(1, '#1a5999');
                ctx.fillStyle = cockpitGradient;
                ctx.fill();
                ctx.strokeStyle = '#0a2544';
                ctx.stroke();
                
                // Peräsin
                ctx.beginPath();
                ctx.moveTo(-25, 0);
                ctx.lineTo(-35, -10);
                ctx.lineTo(-25, -10);
                ctx.closePath();
                ctx.fillStyle = '#d82800';
                ctx.fill();
                ctx.strokeStyle = '#0a2544';
                ctx.stroke();
                
                // Samu - Animoitu potkuri
                ctx.save();
                ctx.translate(30, 5);
                ctx.rotate(this.propellerAngle);
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#222';
                for (let i = 0; i < 2; i++) {
                    ctx.rotate(i * Math.PI);
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.lineTo(12, 0);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.ellipse(8, 0, 4, 1, 0, 0, Math.PI * 2);
                    ctx.fillStyle = '#555';
                    ctx.fill();
                }
                ctx.beginPath();
                ctx.arc(0, 0, 2, 0, Math.PI * 2);
                ctx.fillStyle = '#333';
                ctx.fill();
                ctx.restore();
                
                // Ikkunat
                for (let i = -20; i < 5; i += 7) {
                    ctx.beginPath();
                    ctx.rect(i, 2, 4, 3);
                    ctx.fillStyle = '#6aafff';
                    ctx.fill();
                    ctx.strokeStyle = '#0a2544';
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
                ctx.restore();
            }
            
            // Alex - Määritä pudotetaanko laskuvarjosoturi
            shouldDropParatrooper() {
                return this.dropTimer > 1000 && Math.random() < GAME_CONFIG.entity.paraDropChance;
            }
            
            isActive() {
                return this.active;
            }
        }

        // ===== ILMALAIVA LUOKKA =====
        // Samu - Ilmalaivan piirto (perii Plane luokan)
        // Alex - Ilmalaivan liike ja laskuvarjosoturien pudotus
        class Airship extends Plane {
            constructor() {
                super();
                this.y = 30;
                this.speed = GAME_CONFIG.speed.airship;
                this.width = 120;
                this.height = 40;
                this.dropCount = 0;
                this.maxDrops = 5;  // Pudottaa max 5 laskuvarjosoturia
                this.dropDelay = 500;
                this.dropTimer = 0;
                this.engineGlow = 0;  // Samu - Moottorin hehku animaatio
            }
            
            // Alex - Ilmalaivan liike
            update(deltaTime) {
                this.x += this.direction * this.speed * deltaTime;
                this.dropTimer += deltaTime;
                if (this.x < -this.width || this.x > canvas.width + this.width) {
                    this.active = false;
                }
                // Samu - Moottorin hehku animaatio
                this.engineGlow = (Math.sin(Date.now() / 100) + 1) / 2;
            }
            
            // Samu - Ilmalaivan yksityiskohtainen piirto
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                if (this.direction < 0) {
                    ctx.scale(-1, 1);
                }
                const bodyWidth = this.width;
                const bodyHeight = this.height;
                
                // Ilmalaivan runko (iso soikea)
                ctx.beginPath();
                ctx.ellipse(0, 0, bodyWidth/2, bodyHeight/2, 0, 0, Math.PI * 2);
                const bodyGradient = ctx.createLinearGradient(0, -bodyHeight/2, 0, bodyHeight/2);
                bodyGradient.addColorStop(0, '#c8c8c8');
                bodyGradient.addColorStop(0.4, '#e8e8e8');
                bodyGradient.addColorStop(1, '#888888');
                ctx.fillStyle = bodyGradient;
                ctx.fill();
                ctx.strokeStyle = '#444';
                ctx.lineWidth = 1.5;
                ctx.stroke();
                
                // Peräsin
                ctx.beginPath();
                ctx.moveTo(-bodyWidth/2 + 10, 0);
                ctx.lineTo(-bodyWidth/2 - 10, -bodyHeight/2 - 10);
                ctx.lineTo(-bodyWidth/2 - 15, -bodyHeight/2 - 10);
                ctx.lineTo(-bodyWidth/2 - 5, 0);
                ctx.closePath();
                ctx.fillStyle = '#d82800';
                ctx.fill();
                ctx.strokeStyle = '#444';
                ctx.stroke();
                
                // Viiva
                ctx.beginPath();
                ctx.moveTo(-bodyWidth/2 + 10, 5);
                ctx.lineTo(bodyWidth/2 - 10, 5);
                ctx.strokeStyle = '#777';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // Ikkunat
                for (let i = -bodyWidth/2 + 20; i < bodyWidth/2 - 10; i += 15) {
                    ctx.beginPath();
                    ctx.rect(i, -5, 8, 8);
                    const windowGradient = ctx.createLinearGradient(i, -5, i, 3);
                    windowGradient.addColorStop(0, '#6aafff');
                    windowGradient.addColorStop(1, '#1a5999');
                    ctx.fillStyle = windowGradient;
                    ctx.fill();
                    ctx.strokeStyle = '#0a2544';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
                
                // Gondola (alakori)
                ctx.beginPath();
                ctx.rect(-bodyWidth/4, bodyHeight/2, bodyWidth/2, 15);
                const gondolaGradient = ctx.createLinearGradient(0, bodyHeight/2, 0, bodyHeight/2 + 15);
                gondolaGradient.addColorStop(0, '#8a8a8a');
                gondolaGradient.addColorStop(1, '#555');
                ctx.fillStyle = gondolaGradient;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1.5;
                ctx.stroke();
                
                // Gondolan ikkunat
                for (let i = -bodyWidth/4 + 10; i < bodyWidth/4; i += 15) {
                    ctx.beginPath();
                    ctx.rect(i, bodyHeight/2 + 5, 8, 5);
                    ctx.fillStyle = '#6aafff';
                    ctx.fill();
                    ctx.strokeStyle = '#0a2544';
                    ctx.lineWidth = 0.75;
                    ctx.stroke();
                }
                
                // Samu - Animoitu moottori hehku
                const engineGlowColor = `rgba(255, ${120 + 135 * this.engineGlow}, 0, ${0.5 + this.engineGlow * 0.5})`;
                ctx.beginPath();
                ctx.roundRect(-bodyWidth/3, bodyHeight/2 + 10, 10, 8, 2);
                ctx.fillStyle = '#333';
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(-bodyWidth/3, bodyHeight/2 + 14);
                ctx.lineTo(-bodyWidth/3 - 10, bodyHeight/2 + 18);
                ctx.lineTo(-bodyWidth/3, bodyHeight/2 + 18);
                ctx.closePath();
                ctx.fillStyle = engineGlowColor;
                ctx.fill();
                ctx.beginPath();
                ctx.roundRect(bodyWidth/3 - 10, bodyHeight/2 + 10, 10, 8, 2);
                ctx.fillStyle = '#333';
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(bodyWidth/3, bodyHeight/2 + 14);
                ctx.lineTo(bodyWidth/3 + 10, bodyHeight/2 + 18);
                ctx.lineTo(bodyWidth/3, bodyHeight/2 + 18);
                ctx.closePath();
                ctx.fillStyle = engineGlowColor;
                ctx.fill();
                
                // Logo keskellä
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI * 2);
                ctx.fillStyle = '#d82800';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('AIR', 0, 0);
                ctx.restore();
            }
            
            // Alex - Ilmalaiva pudottaa laskuvarjosotureita säännöllisesti
            shouldDropParatrooper() {
                if (this.dropCount >= this.maxDrops) return false;
                this.dropTimer++;
                if (this.dropTimer >= this.dropDelay) {
                    this.dropTimer = 0;
                    this.dropCount++;
                    return true;
                }
                return false;
            }
        }

        // ===== LASKUVARJOSOTURI LUOKKA =====
        // Samu - Laskuvarjosoturin piirto
        // Alex - Laskuvarjosoturin liike ja heiluminen
        // Miro - Eri vaikeustasot (normaali, kova, elite)
        class Paratrooper {
            constructor(x, y, isTough = false, isElite = false) {
                const margin = canvas.width * 0.05;
                this.x = Math.min(Math.max(x, margin), canvas.width - margin);
                this.y = y;
                this.speed = GAME_CONFIG.speed.paratrooper;
                this.active = true;
                
                // Alex - Heilumis animaatio
                this.swayOffset = 0;
                this.swayDirection = Math.random() < 0.5 ? 1 : -1;
                this.swaySpeed = 0.003;
                this.maxSwayDistance = 15;
                
                // Miro - Vihollistyyppi ja terveys
                this.isTough = isTough;
                this.isElite = isElite;
                if (this.isElite) {
                    this.health = GAME_CONFIG.entity.eliteParatrooperHealth;
                } else if (this.isTough) {
                    this.health = GAME_CONFIG.entity.toughParatrooperHealth;
                } else {
                    this.health = GAME_CONFIG.entity.normalParatrooperHealth;
                }
            }
            
            // Alex - Laskuvarjosoturin liike (putoaminen ja heiluminen)
            update(deltaTime) {
                this.y += this.speed * deltaTime;
                
                // Heiluminen sivusuunnassa
                this.swayOffset += this.swaySpeed * this.swayDirection * deltaTime;
                const margin = canvas.width * 0.05;
                const potentialX = this.x + this.swayOffset * this.maxSwayDistance;
                
                // Käänny jos osuu reunaan
                if (potentialX < margin || potentialX > canvas.width - margin) {
                    this.swayDirection *= -1;
                    this.swayOffset += this.swaySpeed * 2 * deltaTime * this.swayDirection;
                }
                if (Math.abs(this.swayOffset) > 1) {
                    this.swayDirection *= -1;
                }
            }
            
            // Samu - Laskuvarjosoturin piirto (laskuvarjo, köydet, hahmo)
            draw() {
                const paraX = this.x + this.swayOffset * 5;
                
                // Laskuvarjo
                ctx.beginPath();
                ctx.moveTo(paraX - 20, this.y - 20);
                ctx.quadraticCurveTo(paraX, this.y - 45, paraX + 20, this.y - 20);
                const paraGradient = ctx.createLinearGradient(paraX, this.y - 45, paraX, this.y - 20);
                if (this.isElite) {
                    paraGradient.addColorStop(0, '#ffcc00');
                    paraGradient.addColorStop(1, '#cc7700');
                } else if (this.isTough) {
                    paraGradient.addColorStop(0, '#44f');
                    paraGradient.addColorStop(1, '#229');
                } else {
                    paraGradient.addColorStop(0, '#f44');
                    paraGradient.addColorStop(1, '#922');
                }
                ctx.fillStyle = paraGradient;
                ctx.fill();
                ctx.strokeStyle = '#600';
                ctx.stroke();
                
                // Köydet
                ctx.beginPath();
                ctx.moveTo(paraX - 20, this.y - 20);
                ctx.lineTo(paraX, this.y);
                ctx.moveTo(paraX + 20, this.y - 20);
                ctx.lineTo(paraX, this.y);
                ctx.strokeStyle = '#fff';
                ctx.stroke();
                
                // Pää
                ctx.beginPath();
                ctx.arc(paraX, this.y, 5, 0, Math.PI * 2);
                if (this.isElite) {
                    ctx.fillStyle = '#cc7700';
                } else if (this.isTough) {
                    ctx.fillStyle = '#229';
                } else {
                    ctx.fillStyle = '#922';
                }
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.stroke();
                
                // Jalat
                ctx.beginPath();
                ctx.moveTo(paraX, this.y + 5);
                ctx.lineTo(paraX - 5, this.y + 12);
                ctx.moveTo(paraX, this.y + 5);
                ctx.lineTo(paraX + 5, this.y + 12);
                if (this.isElite) {
                    ctx.strokeStyle = '#cc7700';
                } else if (this.isTough) {
                    ctx.strokeStyle = '#229';
                } else {
                    ctx.strokeStyle = '#922';
                }
                ctx.stroke();
                
                // Miro - Näytä terveyspisteet kovia ja elite sotureita varten
                if (this.isTough || this.isElite) {
                    ctx.fillStyle = this.isElite ? '#ffcc00' : '#44f';
                    ctx.font = '9px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(this.health.toString(), paraX, this.y - 25);
                }
            }
            
            // Alex - Tarkista osuiko maahan
            hasLanded() {
                return this.y >= canvas.height - 40;
            }
            
            isActive() {
                return this.active;
            }
        }

        // ===== ÄÄNIMANAGERI LUOKKA =====
        // Samu - Kaikki äänitehoste Web Audio API:lla
        class AudioManager {
            constructor() {
                this.context = new (window.AudioContext || window.webkitAudioContext)();
                this.sounds = {};
                this.createSounds();
            }
            
            // Samu - Luo kaikki äänitehoste
            createSounds() {
                // Ampumis ääni
                this.sounds.fire = this.createSound((ctx) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(100, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(30, ctx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(1, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    return { oscillator, gainNode, duration: 0.2 };
                });
                
                // Laskuvarjon avaus ääni
                this.sounds.parachute = this.createSound((ctx) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(800, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    return { oscillator, gainNode, duration: 0.3 };
                });
                
                // Osuma ääni (normaali vihollinen)
                this.sounds.hit = this.createSound((ctx) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    return { oscillator, gainNode, duration: 0.1 };
                });
                
                // Maahan osumis ääni (menetit elämän)
                this.sounds.ground = this.createSound((ctx) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(150, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.15);
                    gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                    return { oscillator, gainNode, duration: 0.15 };
                });
                
                // Osuma ääni (kova vihollinen)
                this.sounds.toughHit = this.createSound((ctx) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(150, ctx.currentTime + 0.15);
                    gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                    return { oscillator, gainNode, duration: 0.15 };
                });
                
                // Power-up ääni
                this.sounds.powerup = this.createSound((ctx) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.1);
                    oscillator.frequency.exponentialRampToValueAtTime(600, ctx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    return { oscillator, gainNode, duration: 0.2 };
                });
            }
            
            // Samu - Luo ääni setupFunction avulla
            createSound(setupFunction) {
                return () => {
                    const { oscillator, gainNode, duration } = setupFunction(this.context);
                    oscillator.connect(gainNode);
                    gainNode.connect(this.context.destination);
                    oscillator.start(this.context.currentTime);
                    oscillator.stop(this.context.currentTime + duration);
                };
            }
            
            // Samu - Soita ääni nimen perusteella
            playSound(soundName) {
                if (this.context.state === 'suspended') {
                    this.context.resume();
                }
                if (this.sounds[soundName]) {
                    this.sounds[soundName]();
                }
            }
        }

        // ===== LAATIKKO LUOKKA =====
        // Samu - Laatikon piirto ja pyörimisanimaatio
        // Alex - Laatikon putoaminen ja bonus tyyppien määritys
        class Crate {
            constructor(x) {
                this.x = x;
                this.y = 0;  // Ilmestyy ruudun yläreunaan
                this.width = 30;
                this.height = 30;
                this.speed = GAME_CONFIG.speed.crate;
                this.active = true;
                this.bonus = this.randomBonus();
                
                // Samu - Pyörimisanimaatio
                this.rotation = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.002;
            }
            
            // Alex - Valitse satunnainen bonus
            randomBonus() {
                const bonuses = [
                    { type: 'points', value: 1000, color: '#ffd700', symbol: '' },       // Pisteet
                    { type: 'life', value: 1, color: '#ff4444', symbol: '' },            // Ylimääräinen elämä
                    { type: 'burst', value: 1, color: '#ff8800', symbol: '' },           // Burst-tila
                    { type: 'multishot', value: 300, color: '#44ff44', symbol: '' },     // Hajatuli
                    { type: 'slowmo', value: 300, color: '#aa44ff', symbol: '' },        // Hidastus
                    { type: 'nuke', value: 1, color: '#ff0000', symbol: '' },            // Tuhoa kaikki
                    { type: 'bigbullet', value: 300, color: '#4444ff', symbol: '' },     // Isot ammukset
                    { type: 'scorex2', value: 300, color: '#ffd700', symbol: '' }        // Pisteet x2
                ];
                return bonuses[Math.floor(Math.random() * bonuses.length)];
            }
            
            // Samu - Laatikon piirto (pyörivä laatikko symbolilla)
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // Laatikon runko
                ctx.fillStyle = this.bonus.color;
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
                ctx.strokeRect(-this.width/2, -this.height/2, this.width, this.height);
                
                // Risti kuvio
                ctx.beginPath();
                ctx.moveTo(-this.width/2, 0);
                ctx.lineTo(this.width/2, 0);
                ctx.moveTo(0, -this.height/2);
                ctx.lineTo(0, this.height/2);
                ctx.strokeStyle = '#ffffff80';
                ctx.stroke();
                
                // Bonus symboli
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.bonus.symbol, 0, 0);
                ctx.restore();
            }
            
            // Alex - Laatikon putoaminen
            update(deltaTime) {
                this.y += this.speed * deltaTime;
                this.rotation += this.rotationSpeed * deltaTime;
                // Poista laatikko jos menee ruudun ulkopuolelle
                if (this.y > canvas.height) {
                    this.active = false;
                }
            }
        }

        // ===== PELIN ALUSTUS JA PÄÄSILMUKKA =====
        // Alex & Samu & Miro - Tiimityö
        const game = new Game();

        // Pääpeli silmukka
        function gameLoop(timestamp) {
            game.update(timestamp);  // Alex - Päivitä pelimekaniikka
            game.draw();             // Samu - Piirrä kaikki
            requestAnimationFrame(gameLoop);
        }

        // Käynnistä peli
        requestAnimationFrame(gameLoop);
        
        // ===== TEKIJÄT =====
        // Samu - Lentokoneet, ilmalaivat, laskuvarjosoturit, äänet, animaatiot ja grafiikka
        // Alex - Pelimekaniikka, törmäykset, ampuminen, vaikeustasot ja bonukset
        // Miro - Aloitusnäyttö, ohjeet, vihollistyyppien esittely ja vaikeustasojärjestelmä
    </script>
</body>
</html>
